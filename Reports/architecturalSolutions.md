## Тема: 
AS-1: Выбрать базу данных MySQL и разделить её на несколько отдельных частей

## Статус:
Принято

## Контекст: 
В системе существует несколько видов пользователей, каждый из которых влияет на базу данных. Так, аналитик может просматривать как каталог товаров, так и данные клиентов. А менеджер по управлению каталогом может менять каталог и просматривать его. Менеджеру каталога не нужно иметь доступ к данным клиентов. MySQL имеет множество функций, в том числе технологию zlib, позволяющую сжимать архивированные данных, а также лёгкое создание бэкапа.


## Решение:
Выбранная база данных MySQL будет разделена на несколько отдельных частей, к каждой из которых будет доступ у разных видов пользователей. Режим работы базы будет стандартным.

## Последствия:
Плюсы:
- Масштабируемость. MySQL масштабируема под новые сервисы, её изменение технически несложно.
- Реплицируемость. MySQL поддерживает простую репликацию, что позволяет создавать бэкапы.
- Безопасность. MySQl предлагает средства безопасности, такие как шифрование данных, контроль доступа и аудит и разделение прав доступа, при котором снижается риск получения доступа к важным данным, наличие доступа к которым не нужно тем или иным видам пользователей системы.
- Целостность. Доступные только для просмотра данные невозможно специально или случайно отредактировать или удалить. Также, если чужие данные нельзя просмотреть, то их невозможно изменить в целях нанесения вреда.
- Снижение путаницы. Для работника проще видеть только необходимые таблицы и работать с ними, чем иметь доступ ко всем таблицам, из которых нужны только несколько.

Минусы:
- Усложнение администрирования. Настройка разных ролей доступа усложнит управление базой данных.
- Уменьшение гибкости. При изменении условий ведения бизнеса, из-за разделения базы на уровни доступа, уменьшается гибкость системы в целом.

---
## Тема: 
AS-2: Использовать сервисную (Service-based architecture) архитектуру как базовую в разработке и представлении

## Статус:
Принято

## Контекст: 
В ходе разработки архитектуры мы поняли, что делать её монолитной для достаточно типичной информационной системы дорого с точки зрения разработки и нелогично. В ходе рассмотрения вариантов архитектуры, мы пришли к выводу, что нам больше подходит service-based, модульная архитектура. Наше приложение завязано на использовании множества сервисов. Тем не менее, внедрение микросервисной архитектуры для нас проблематично - информационная система завязана на работу с определёнными модулями. Их замена возможна, но осуществляется нелегко. Поскольку SBA имеет меньшую степень декомпозиции, она нам подходит больше, чем иные варианты.
Отличия SBA архитектуры от монолитной:
- Система декомпозирована, её основу составляют сервисы
- Общее количество служб в среднем от 4 до 12, тогда как у монолитной архитектура едина
- Архитектура более адаптируема и масштабирована
- Может быть дороже реализовывать и поддерживать в малых проектах
Отличия SBA архитектуры от микросервисной:
- Меньшая степень декомпозиции, чем у микросервисной. Микросервисная архитектура подразумевает десятки и более сервисов
- В базовой топологии предполагается создание единой базы данных
- Дешевле реализовывать и поддерживать

## Решение:
В ходе обсуждений мы начали прорабатывать домены, на которые будет разделена система, в том числе и разделение базы данных на части, и то, у каких ролей будет доступ к какой из частей.

## Последствия:
Плюсы:
- Модульность. Такая архитектура позволяет создавать приложение на основе относительно независимых модулей, что упрощает разработку, тестирование и обслуживание
- Гибкость и масштабируемость. Модульная архитектура гибка в разработке и дальнейших стадиях создания и обслуживания. Добавление новых сервисов проще, чем изменение всего монолитного кода.
- Относительно крупные сервисы. Большие сервисы проще разрабатывать для нашей архитектуры и их взаимодействие проще организовать, в отличие от микросервисной архитектуры.

Минусы:
- Плохая тестируемость. Из-за большого количества сервисов, значительная часть которых не принадлежит нам, её сложнее тестировать.
- Не лучшая разворачиваемость. Создать и развернуть модульную систему сложнее, чем монолитную.
- Отказоустойчивость. Система на основе SBA-архитектуры менее отказоустойчива, чем микросервисная.

---

## Тема: 
AS-3: Зафиксировать, какие части нашей системы будут внешними модулями, а какие нет

## Статус:
Принято

## Контекст: 
Для продолжения разработки архитектуры необходимо уточнить, какие её части будут разрабатываться нами, а какие будут являться внешними модулями

## Решение:
Мы приняли, что наша система не занимается информационным обслуживанием доставки и хранения - эти занимается служба логистики. Задача нашей системы лишь получать информацию о доставке, которая подробнее расписана в диаграммах. Также наша система будет использовать внешнюю аналитику - сервис Яндекс Метрика

## Последствия:
Плюсы:
- Простота в подключении. Сторонний сервис достаточно интегрировать, его не нужно разрабатывать.
- Надёжность. Мы берём готовые решения у надёжных поставщиков ПО, таких как Яндекс.

Минусы:
- Невозможно изменять. Мы никак не можем изменить код сторонних сервисов.
- Сложность в тестировании. Мы видим лишь входы и выходы системы, и не видим её внутреннюю часть. Это усложняет тестирование.

---

## Тема: 
AS-4: Использовать WhatsApp Buisness или аналоги в качестве средства общения с клиентами для службы поддержки

## Статус:
Принято

## Контекст: 
При разработке архитектуры мы опираемся на идею о том, что нет необходимости создавать программные решения с нуля, когда они уже созданы. В бизнесе широко используются приложения для месседжеров, такие как WhatsApp Buisness, позволяющие общаться с клиентом с корпоративного аккаунта.

## Решение:
Мы приняли, что общение с клиентами должно происходить через корпоративные аккаунты в месседжерах типа WhatsApp или Telegram. Это удобно и понятно для клиентов.

## Последствия:
Плюсы:
- Простота в коммуникации. Клиентам проще коммуницировать через знакомые средства обмена информацией.
- Упрощение обучения операторов. Работников магазина проще обучить использованию усложнённой, но знакомой системы, чем полностью новой.

Минусы:
- Невозможность изменения кода. Выбор готовых решений накладывает все выше перечисленные издержки, в том числе и невозможность изменить код.

---

## Тема: 
AS-5: Уточнить методы разделения базы данных

## Статус:
Принято

## Контекст: 
В AS-1 недостаточно подробно описано, каким образом будет разделена база данных. Это архитектурное решение уточнит, каким образом это будет реализовано.

## Решение:
База данных будет фактически разделена лишь на две части - актуальную, и архивную, в которую будут заноситься данные о транзакциях, которые не будут нужны в работе магазина, но могут понадобиться для аналитики или налоговой отчётности в будущем. В архивной базе данных будет использования технология сжатия zlib. Однако база данных будет разделена логически по уровням доступа различных пользователей. Для работы с данными в формате "только просмотр" будут использованы представления. Архивация предполагает перенесение финансово значимых строк и таблиц каждый год в архивную базу данных. 

## Последствия:
Плюсы:
- Скорость создания. Создание двух баз быстрее, чем пяти и более, что предполагалось изначально.
- Простота в обслуживании. Управлять одной базой данных легче, чем множеством.
- Возможность не хранить малополезные данные в продуктовой базе.

Минусы:
- Меньшая безопасность. Защита данных у одной базы со множеством уровней доступа сложнее, чем множества разных баз с небольшим количеством уровней доступа.
- Увеличение зависимости сервисов друг от друга. Из-за использования общей базы данных, подключение новых сервисов усложняется, и способность системы к расширяемости уменьшена.

---

## Тема: 
AS-6: Использование API-шлюзов в архитектуре

## Статус:
Принято

## Контекст: 
В сервисной архитектуре необходимо осуществлять общение между сервисами по общим API-шлюзам. API-шлюз - это компонент, который принимает вызовы от клиентов, маршрутизирует их к соответствующим сервисам, при необходимости преобразует протоколы и возвращает ответ клиенту. Он абстрагирует сложности микросервисной архитектуры и предоставляет клиентам единообразный интерфейс для взаимодействия. При вызове клиентским приложением API-шлюз принимает HTTP-запрос от клиента, проверяет аутентификацию и авторизацию клиента, определяет, какой сервис должен обработать запрос, отправляет запрос в сервис, при необходимости преобразуя протокол, получает ответ от сервиса и возвращает ответ клиенту.

## Решение:
Использовать API-шлюзы для клиента (т.е. покупателя, посетителя сайта), сотрудников, логистики, транзакции. Более подробно про использование API-шлюзов написано в базовых диаграммах.

## Последствия:
Плюсы:
- Возможность маршрутизации запросов позволяет распределять нагрузку и ускорить систему.
- Обеспечение взаимодействия между сервисами позволяет системе функционировать в Service-based
- Наличие единого интерфейса обращений оптимизирует код и ускоряет разработку. 

Минусы:
- Риск утечки данных. Если API-шлюз будет скомпрометирован, это может привести к утечке данных и несанкционированному доступу к сервисам. Поэтому важно обеспечить безопасность шлюза.
- Сложность реализации. Реализация API-шлюза требует решения ряда задач, таких как маршрутизация, преобразование протоколов, аутентификация, мониторинг и др. Это добавляет сложности по сравнению с прямым взаимодействием клиента и сервисов.

---

## Тема: 
AS-7: Уточнить декомпозицию системы

## Статус:
Принято

## Контекст: 
Согласно решению о принятии Service-based архитектуры, система должна быть декомпозирована. Декомпозиция системы описана в диаграммах, но её не существовало в виде архитектурного решения. В этом решении более подробно описано то, на какие сервисы делится система.

## Решение:
Добавление нескольких внутренних и внешних подсистем в архитектуру:
- Сервис веб-аналитики Яндекс Метрика. Выполняет веб-аналитику сайта для отслеживания посещаемости и других KPI.
- Месседжеры, например WhatsApp и Telegram. Предоставляют удобный способ общения с клиентом в уже знакомом клиенту интерфейсе и через специальные расширения (пр. WhatsApp Buisness) для удобства службы поддержки.
- Платёжная система. Отвечает за проведение безналичных рассчётов в основном бизнес-процессе - покупке товара, а так же в случае его возврата.
- Система отправки e-mail. Служит для оповещения пользователей о статусе доставки, рекламных акциях.
- Служба логистики. Внешняя система, занимающаяся отправкой и перевозкой товаров, хранением и доставкой, а также закупкой ассортимента в соответствии с требованиями.

## Последствия:
Плюсы:
- Современные и удобные сервисы просто интегрировать.
- Внешние системы не нуждаются в поддержке со стороны команды магазина.

Минусы:
- Невозможность контролировать внутреннюю работу сторонних сервисов.

---

## Тема:
AS-8: Использование JWT для авторизации

## Статус:
Принято

## Контекст:
Система авторизации должна быть защищена и масштабируема. В рамках принятого решения использовать сервисную архитектуру, необходимо определить способ аутентификации и авторизации пользователей. Решено использовать JWT (JSON Web Token) для обеспечения безопасности и упрощения взаимодействия между различными сервисами системы.

## Решение:
Сервис аутентификации обрабатывает регистрацию и вход пользователя, создаёт JWT при успешной аутентификации и передаёт токен клиенту. Клиентское приложение хранит и использует JWT для выполнения защищённых запросов. Внутренние и внешние микросервисы авторизуют запросы, проверяя наличие и валидность JWT, расшифровывают его для извлечения информации о пользователе.

## Последствия:
Плюсы:
- Безопасность. JWT защищены цифровой подписью, что предотвращает их подделку.
- Масштабируемость. Валидация JWT не требует обращения к центральному серверу аутентификации, что снижает нагрузку на него и ускоряет обработку запросов.
- Универсальность. JWT стандартизированы и могут быть использованы в различных языках программирования и платформах.

Минусы:
- Безопасность хранения. Необходимо надежно хранить JWT на клиенте, чтобы предотвратить их кражу.
- Отзыв токенов. Отозвать или изменить права доступа JWT до истечения его срока действия сложно, что требует дополнительных механизмов управления сессиями.

---

## Тема:
AS-9: Использование очередей для передачи данных

## Статус:
Принято

## Контекст:
Для обеспечения надёжной и асинхронной передачи данных при отправке заказов в службу логистики и обработке платежей необходимо использовать механизм очередей. Очереди сообщений (Message Queue) — это форма асинхронной коммуникации между сервисами. Очереди помогут эффективно управлять процессами обмена данными между различными сервисами системы. 

## Решение:
Использование очередей для передачи данных включает следующие компоненты. Сервис заказов или оплаты при создании нового заказа или приёме платежа помещает сообщение в соответствующую очередь. Служба логистики или платёжная система читают сообщения из очереди и обрабатывают их. При успешной обработке сообщение удаляется из очереди.

## Последствия:
Плюсы:
- Надёжность. Очереди обеспечивают гарантированную доставку сообщений даже в случае временных сбоев отдельных сервисов.
- Масштабируемость. Асинхронная обработка сообщений позволяет эффективно распределять нагрузку и масштабировать обработку.
- Предотвращение перегрузок. Очереди могут временно хранить данные, сглаживая пиковые нагрузки и предотвращая перегрузку системы.

Минусы:
- Сложность мониторинга. Необходимо внедрение инструментов мониторинга для отслеживания состояния и производительности очередей.
- Задержки. Асинхронная обработка может привести к задержкам в выполнении операций, что нужно учитывать при проектировании системы.

---

## Тема:
AS-10: Использование представлений для запросов данных

## Статус:
Принято

## Контекст:
Для обеспечения безопасного и удобного доступа к данным отдела по работе с клиентами необходимо использовать представления (views) базы данных. Представления помогут предоставить информацию в формате readonly, что позволит сотрудникам отдела по работе с клиентами анализировать важные данные без риска изменения исходных данных.

## Решение:
В базе данных создаются представления, которые формируются из необходимых таблиц и предоставляют данные в требуемом формате. Эти представления конфигурируются как readonly и используются отделом по работе с клиентами для анализа данных. Представления обновляются автоматически при изменении данных в исходных таблицах, обеспечивая актуальность информации.

## Последствия:
Плюсы:
- Безопасность: Представления позволяют предоставить доступ к данным в режиме только для чтения, что предотвращает их изменение сотрудниками.
- Удобство использования: Представления упрощают доступ к сложным запросам и структурам данных, предоставляя информацию в удобном формате.
- Актуальность данных: Представления автоматически обновляются при изменении данных в исходных таблицах, обеспечивая актуальность информации.

Минусы:
- Производительность: Использование сложных представлений может замедлить выполнение запросов, что требует оптимизации.
- Ограниченность функци: Представления не могут использоваться для выполнения всех видов запросов, что накладывает ограничения на их функциональность.

---

## Тема:
Использование REST/HTTPS/HTTP для взаимодействий внутри системы

## Статус:
Принято

## Контекст:
Для стандартизации взаимодействия между различными компонентами системы, а также для связи с внешними сервисами, необходимо использовать REST (Representational State Transfer) поверх протоколов HTTP/HTTPS. REST является архитектурным стилем, который упрощает управление веб-ресурсами и стандартизирует запросы к бэкенду, обеспечивая совместимость и упрощая интеграцию.

## Решение:
Использование REST/HTTPS/HTTP для взаимодействия компонентов системы и внешних сервисов включает следующие компоненты. REST API используется для стандартизированного обмена данными между клиентом и сервером через HTTP или HTTPS протоколы. Примеры методов взаимодействия:

- **GET /api/item/**: получить все предметы.
- **GET /api/item/3**: получить предмет с ИД 3.
- **POST /api/item/**: создать новый предмет.
- **POST /api/item/3**: изменить данные предмета с ИД 3.
- **DELETE /api/item/3**: удалить предмет с ИД 3.

Эти запросы позволяют управлять ресурсами системы эффективно и безопасно.

## Последствия:
Плюсы:
- Стандартизация. REST API обеспечивает единый стандарт для взаимодействия, что упрощает интеграцию и взаимодействие между различными частями системы и внешними сервисами.
- Простота. REST использует простые и понятные HTTP методы (GET, POST, PUT, DELETE), что облегчает разработку и поддержку.

Минусы:
- Безопасность. Взаимодействие через HTTP/HTTPS требует дополнительных мер безопасности, таких как аутентификация и шифрование данных, чтобы предотвратить несанкционированный доступ и утечки данных.
- Ограничения HTTP. Некоторые сложные операции могут быть трудны для реализации с использованием только стандартных HTTP методов, что может потребовать дополнительных соглашений и расширений.
